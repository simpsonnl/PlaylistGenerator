@model PlaylistGenerator.ViewModels.IndexViewModel

@{
    ViewBag.Title = "Home Page";

}



    <div style="margin-top:30px;">

        <h1 style="color:white; text-align:center;">Search</h1>
        
        <!-- Search form -->
        @using (Html.BeginForm("CreatePlaylist", "Playlist", FormMethod.Post, new { id = "createForm" }))
        {
            <div class="conainer" style="color:white;">
                
                    
                <div class="form-group mb-4">
                    <input type="hidden" id="inputId" name="inputId" value="" />
                    <input type="hidden" id="isTrack" name="isTrack" value="true" />
                    <div class="row">
                        <div class="col-lg-3"></div>
                        <div class="col-lg-8">
                            <div class="row">
                                
                                    <input id="searchTrack_Name" type="search" class="form-control" placeholder="Search for a song..." name="query" spellcheck="false" style="max-width:530px; align-content:center;" />
                                
                                    <div style="padding-left:10px;">
                                    <button disabled id="submit" type="submit" class="btn btn-light rounded" style="padding:6px 5px 6px 5px;">Generate</button>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row">
                                
                                <input type="checkbox" id="toggle-two" style="padding-left:10px;">
                            </div>
                        </div>
                    </div>
                    <dvi class="row">
                        <div class="col-lg-3"></div>
                        <div class="col-lg-8" style="padding-top:10px; padding-left:0px;">
                                <button class="advanced_settings_btn" id="showhidetrigger" type="button" style="background:none; border:none; color:white; padding:3px 3px 3px 3px;">Advanced Settings</button>
                        </div>
                    </dvi>
                    

                </div>
                    
                    
                        
                        <div id="showhidetarget">
                            <div class="row" style="padding-bottom:10px;">
                                <div class="col-lg-3"></div>
                                <div class="col-lg-4">

                                    <div style="padding-top:10px; padding-left:0px;" class="budget row">How many different artists?</div>
                                    <div class="row">
                                        <div>
                                            <input type="range" name="range" id="range" min="1" max="5" step="1" value="3" class="custom-range" style="width:300px;" />
                                        </div>
                                    </div>
                                    <div class="row"><label for="range" id="rangeLabel">A good amount of artists</label></div>
                                </div>
                                <div class="col">
                                    <div class="row h-100 align-items-center">
                                        <select id="numberOfTracks" name="numberOfTracks" class="custom-select" style="width:133px;">
                                            @*<option disabled="disabled" selected="selected" value="">Select a playlist size...</option>*@
                                            <option value="15">15 Songs</option>
                                            <option id="30Option" value="30" selected="selected">30 Songs</option>
                                            <option id="50Option" value="50">50 Songs</option>
                                            <option id="100Option" value="100">100 Songs</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                
            </div>
        }

        <p id="imageSelectLabel" class="lead" @(Model.profile==null ? "hidden" : "") style="color:white;">Or select one your recent songs.</p>
        <div class="conainer">
            <div id="recentTracks" class="row justify-content-between h-100" style="margin-right:0px !important; margin-left:0px !important;">
                @foreach (var track in Model.recentTracks)
                {
                    <div>
                        @using (Html.BeginForm("CreateFromCard", "Playlist", FormMethod.Post))
                        {
                            <input hidden name="numberOfTracks" class="numTracks" value="30"/>
                            <input hidden name="range" class="range" value="3"/>
                            <input hidden name="isTrack" value="true"/>
                            <input hidden name="inputId" value="@track.Id"/>
                        
                        <div class="card" style=" max-height:202px; max-width:204px; position:relative;">
                            <button class="card-button" type="submit" style="padding:0;border:none;">
                                <img class="img card-img-top" src="@track.Album.Images[0].Url" height="200" width="200" style="border-radius: 2%;"/>
                            </button>
                                <div class="card_name card-body text-white rgba-black-light p-2">@track.Name</div>
                        </div>
                        
                        }
                    </div>
                }
            </div>
        </div>
            <div class="conainer justify-content-between">
                <div id="recentArtists" class="row justify-content-between" style="width:1110px; margin-right:0px !important; margin-left:0px !important;">
                    @foreach (var artist in Model.topArtists)
                    {
                    <div>
                        @using (Html.BeginForm("CreateFromCard", "Playlist", FormMethod.Post))
                        {
                            <input hidden name="numberOfTracks" class="numTracks" value="30" />
                            <input hidden name="range" class="range" value="3" />
                            <input hidden name="isTrack" value="false" />
                            <input hidden name="inputId" value="@artist.Id" />

                            <div class="card" style=" max-height:202px; max-width:204px; position:relative;">
                                <button class="card-button" type="submit" style="padding:0;border:none; background-color:#343a40;">
                                    <img class="img card-img-top" src="@artist.Images[0].Url" height="200" width="200" style="border-radius: 2%;"/>
                                </button>
                                    <div class="card_name card-body text-white rgba-black-light p-1">@artist.Name</div>
                            </div>
                        }
                    </div>
                    }
                </div>
            </div>
        </div>

@section Scripts{

    <script type="text/javascript">

        $(document).ready(function () {
            $('#showhidetarget').hide();

            $('#showhidetrigger').click(function () {
                $('#showhidetarget').toggle(400);
            });
        });


        $(document).ready(function () {
            $('#recentArtists').hide();
        });

        var url = "/Home/SearchTrack";
        var boxId = "#searchTrack_Name";
        var count = 1;
        var boxVal = "";
        //autocomplete for the search bar
        $(document).ready(function () {
            $(boxId).autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: url,
                        type: "POST",
                        dataType: "json",
                        data: { query: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item.Name, value: item.Id };

                            }))

                        }
                    })
                },

                focus: function (event, ui) {
                    var v = ui.item.label;
                    //$(boxId).attr('placeholder', v);
                    event.preventDefault();
                },
                select: function (event, ui) {
                    var v = ui.item.label;
                    $('#inputId').val(ui.item.value);
                    $(boxId).val(v);

                    // update what is displayed in the textbox
                    $(this).value = v;
                    $('#submit').attr('disabled', false);
                    count = 0;
                    boxVal = v;
                    //this.form.submit();
                    return false;
                }
            });
        });

        //$(boxId).change(function () {
        //    if (count!=0) {
        //        $('#submit').attr('disabled', true);
        //    }
        //    count = 1;;
        //});

        $(boxId).on('keyup keypress', function(e)  {
            var keyCode = e.keyCode || e.which;
            var nowBoxVal = $(boxId).val();
            if (keyCode === 13) {
                return;
            }
            if (boxVal != nowBoxVal) {
                $('#submit').attr('disabled', true);
            } else {
                if (nowBoxVal != "") {
                $('#submit').attr('disabled', false);
                 }
            }
            
            
        });

        //changes the search box placeholder and id when the toggle is changed
        $('input:checkbox').change(function () {
            if (document.getElementById('toggle-two').checked) {
               
                $("#searchTrack_Name").attr('placeholder', 'Search for an artist...');
                $("#searchTrack_Name").attr('id', 'searchArtist_Name');
                $('#recentTracks').hide();
                $('#recentArtists').show();
                $('#imageSelectLabel').html('Or select one of your recent artists.');
                $("#isTrack").val(false);
                url = "/Home/SearchArtistTerm";
                boxId = "#searchArtist_Name";

            } else {
                $("#searchArtist_Name").attr('placeholder', 'Search for a song...');
                $("#searchArtist_Name").attr('id', 'searchTrack_Name');
                $('#recentTracks').show();
                $('#recentArtists').hide();
                $('#imageSelectLabel').html('Or select one of your recent songs.');
                $("#isTrack").val(true);
                url = "/Home/SearchTrack";
                boxId = "#searchTrack_Name";
            }
        });

        $('#numberOfTracks').change(function () {
            var v = $('#numberOfTracks').val();
            var x = document.getElementsByClassName("numTracks");
            for (var i = 0; i < x.length; i++) {
                x[i].value = v;
            }
        });

        //function for the slider value
        $(document).on('input', '#range', function () {
            var v = $('#range').val();
            var x = document.getElementsByClassName("range");
            for (var i = 0; i < x.length; i++) {
                x[i].value = v;
            }

            var NumberOfTracksVal = $('#numberOfTracks').val();
            $('#rangeLabel').html($(this).val());
            $('#recentArtistsArtistrange').val($(this).val());
            if ($(this).val() == 1) {
                
                $('#rangeLabel').html("A couple artists");
                $('#100Option').attr('disabled', true);
                $('#50Option').attr('disabled', true);
                if (NumberOfTracksVal != 30) {
                    ($('#numberOfTracks').val(30));
                }
            } else if ($(this).val() == 2) {
                $('#rangeLabel').html("A few artists");
                $('#100Option').attr('disabled', true);
                $('#50Option').attr('disabled', false);
                if (NumberOfTracksVal == 100) {
                    ($('#numberOfTracks').val(50));
                }


            } else if ($(this).val() == 3) {
                $('#rangeLabel').html("A good amount of artists");

            }else if($(this).val() == 4){
                $('#rangeLabel').html("Now were talking");
            } else {
                $('#rangeLabel').html("Gimme all of em");
                $('#100Option').attr('disabled', false);
                $('#50Option').attr('disabled', false);
            }
        });

        $('#createForm').on('keyup keypress', function(e) {
  var keyCode = e.keyCode || e.which;
  if (keyCode === 13) { 
    e.preventDefault();
    return false;
  }
});
    </script>
}
